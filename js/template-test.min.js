var tableData={code:"codeTable",gridHeader:[{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"序号",isShow:true,code:"code0"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"商品图片",isShow:false,code:"code1"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"商品名称",isShow:true,code:"code2"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"商家编码",isShow:true,code:"code3"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"货号",isShow:true,code:"code4"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"销售属性",isShow:true,code:"code5"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"单价",isShow:true,code:"code6"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"数量",isShow:true,code:"code7"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"金额",isShow:true,code:"code8"},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"货位",isShow:false,code:"code9"}],gridBody:[[{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"1",isShow:true},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"<img src='images/i1.jpg'/>",isShow:false},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"衬衫",isShow:true},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"B001",isShow:true},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"G001",isShow:true},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"xxx",isShow:true},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"80",isShow:true},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"5",isShow:true},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"400",isShow:true},{style:"font-size: 15px;text-align: center;font-family: 黑体",itemValue:"no-1",isShow:false}]]};function rgb2hex(a){a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function b(c){return("0"+parseInt(c).toString(16)).slice(-2)}return"#"+b(a[1])+b(a[2])+b(a[3])}var createElement=function(b,c,e){var d=document.createElement(b);if(typeof(c)==="string"){e=c;c=null}if(c!==undefined){for(var a in c){d.setAttribute(a,c[a])}}if(e!==undefined){d.innerHTML=e}return d};var renderRule=function(b,c){var h=parseInt($(b).width()/10);var d=parseInt($(b).height()/10);if($(c).find(".rules").length<=0){var g=$("<div class='rules'></div>").appendTo($(c));var f=$('<div class="rule rule-top"></div>').appendTo($(g));var e=$('<div class="rule rule-right"></div>').appendTo($(g));var a=$('<div class="rule rule-bottom"></div>').appendTo($(g));var i=$('<div class="rule rule-left"></div>').appendTo($(g))}$(".rule-top").html(createRule("top",h));$(".rule-bottom").html(createRule("bottom",h));$(".rule-left").html(createRule("left",d));$(".rule-right").html(createRule("right",d))};var createRule=function(g,c){var f=[];var b=createElement("div");switch(g){case"top":f=["height","left"];break;case"left":f=["width","top"];break;case"bottom":f=["height","left"];break;case"right":f=["width","top"];break}for(var d=0,a=c;d<=a;d++){var e=createElement("div",{"class":"rule-scale"});$(e).css(f[1],10*d+18+"px");if(d>0){if(d%5===0){$(e).css(f[0],"50%")}if(d%10===0){$(e).css(f[0],"100%").html("<span>"+d*10+"</span>")}}else{$(e).css(f[0],0)}$(e).appendTo($(b))}return b};var drag=function(a,b,c){$(a).on("mouseenter",function(){$(this).css("cursor","move")});$(a).on("mousedown",function(g){g=g||window.event;var d=a===b?this:$(this).parents(b)[0];var j=g.clientX-d.offsetLeft;var h=g.clientY-d.offsetTop;var i=parseFloat(getComputedStyle(d).width);var e=parseFloat(getComputedStyle(d).height);var k=parseFloat(getComputedStyle($(c)[0]).width);var f=parseFloat(getComputedStyle($(c)[0]).height);document.onmousemove=function(m){m=m||window.event;var l=m.clientX-j;var n=m.clientY-h;if(l<=0){l=0}else{if(l>=(k-i)){l=k-i}}if(n<=0){n=0}else{if(n>=(f-e)){n=f-e}}d.style.left=l+"px";d.style.top=n+"px"}});$(a).on("mouseup",function(){document.onmousemove=null})};var resize=function(a){$.each($(a),function(){var b="";$(this).off("click").on("click",function(){b=$(this);var d="";var e="";var f="";var c="";if(b.find(".rth").length<=0){if(f===""&&d===""&&e===""&&c===""){if(!b.parents().hasClass("move-element")){c=$('<div class="rth rth-top"   ></div>').appendTo(b);d=$('<div class="rth rth-left"  ></div>').appendTo(b);f=$('<div class="rth rth-bottom"></div>').appendTo(b)}e=$('<div class="rth rth-right" ></div>').appendTo(b);b.find(".rth").show().on("mousedown",function(l){l=l||window.event;l.stopPropagation();var k=l.currentTarget;var h=b.width();var j=b.height();var g=parseFloat(b.css("left"));var i=parseFloat(b.css("top"));var n=l.clientX;var m=l.clientY;$(document).on("mousemove",function(p){p=p||window.event;var o=p.clientX-n;var q=p.clientY-m;if($(k).hasClass("rth-right")||$(k).hasClass("rth-bottom")){b.css({width:h+o+"px",height:j+q+"px"})}else{b.css({width:h-o+"px",left:g+o+"px",height:j-q+"px",top:i+q+"px"})}})});$(document).on("mouseup",function(){$(document).off("mousemove")})}}})})};var addElement=function(){$(".add-panel .add-table").off("click").on("click",function(){addTable(tableData);resize(".move-element");panel()});$(".add-panel .add-default").off("click").on("click",function(){var a=$('<div class="div-default move-element" style="font-family: 黑体;font-size: 16px;text-align: left"><span class="default-text">【'+$(this).html()+"】</span></div>").appendTo($("#panel"));drag(a,a,"#panel");resize(".move-element");panel()});$(".add-panel .add-custom").off("click").on("click",function(){var a=$('<div class="div-custom  move-element" style="font-family: 黑体;font-size: 16px;text-align: left"><span class="custom-text">【'+$(this).html()+"】</span></div>").appendTo($("#panel"));drag(a,a,"#panel");resize(".move-element");panel()});$(".add-panel .add-line").off("click").on("click",function(){var a=$('<div class="div-line  move-element" direction="horizontal"></div>').appendTo($("#panel"));switch($(a).attr("direction")){case"horizontal":$(a).addClass("line-h").removeClass("line-v");break;case"vertical":$(a).addClass("line-v").removeClass("line-h");break}drag(a,a,"#panel");resize(".move-element");panel()})};var addTable=function(e,d){var f=document.createDocumentFragment();var b=$('<table class="table move-element" code="'+e.code+'"></table>').appendTo($(f));var a=$("<tbody></tbody>").appendTo(b);var c=$('<tr class="tr"></tr>').appendTo(a);if(d!==undefined){b.css({width:d.w,height:d.h,left:d.x,top:d.y})}$.each(e.gridHeader,function(h,g){if(g.isShow){$('<th class="td" code="'+g.code+'" style="'+g.style+'">'+g.itemValue+"</th>").appendTo(c)}else{$('<th class="td" code="'+g.code+'" style="'+g.style+';display: none">'+g.itemValue+"</th>").appendTo(c)}});$.each(e.gridBody,function(h,i){var g=$('<tr class="tr"></tr>').appendTo(b);$.each(i,function(j,k){if(k.isShow){$('<td class="td" style="'+k.style+'">'+k.itemValue+"</td>").appendTo(g)}else{$('<td class="td" style="'+k.style+';display: none">'+k.itemValue+"</td>").appendTo(g)}})});$(f).appendTo($("#panel"));drag(".table",".table","#panel");resize(".move-element");panel()};var panel=function(){var f="";$.each($(".move-element"),function(){$(this).on("click",function(){f=$(this);f.css("background-color","#fbafa7").siblings().css("background-color","#fff").find(".rth").remove();if($(this).find("img.panel-bg").length<=0){if($(document.body).find(".edit-panel").length<=0){b(".edit-panel")}if(f.hasClass("table")){var g=[];$.each(f.find("th.td"),function(j,h){var k={};k.value=h.innerHTML;k.isShow=$(this).css("display")==="none"?false:true;k.code=$(h).attr("code");g.push(k)});e(g)}else{if(f.hasClass("div-default")){d()}else{if(f.hasClass("div-custom")){a()}else{if(f.hasClass("div-line")){c()}}}}drag(".edit-panel>.title",".edit-panel",document.body);$(".edit-panel").show();$(".edit-panel .btn-delete").off("click").on("click",function(){f.remove();$(".edit-panel").remove()})}else{$(".edit-panel").remove()}})});var e=function(i){$(".edit-panel .panel-ctrl").html("");var g=createElement("div",{"class":"ctrl-item"});$(g).appendTo($(".edit-panel .panel-ctrl"));var h=$('<label class="ctrl-item-title">表列</label>').appendTo($(g));var j=createElement("div",{"class":"ctrl-item-content"});$(j).appendTo($(g));$.each(i,function(l,k){var m=$('<div class="table-item"></div>').appendTo($(j));if(k.isShow){$('<input class="table-choose" type="checkbox" checked>').appendTo(m);$('<input class="table-title" type="text" readonly value="'+k.value+'">').appendTo(m);$('<a class="table-edit">编辑</a>').appendTo(m)}else{$('<input class="table-choose" type="checkbox">').appendTo(m);$('<input class="table-title" type="text" readonly value="'+k.value+'">').appendTo(m);$('<a class="table-edit table-edit-unchecked">编辑</a>').appendTo(m)}});$.each($(".table-item input.table-choose"),function(l,k){$(this).on("click",function(){if(!this.checked){$.each(f.find(".tr"),function(){$($(this).find(".td")[l]).hide()});$(this).siblings("a.table-edit").addClass("table-edit-unchecked")}else{$.each(f.find(".tr"),function(){$($(this).find(".td")[l]).show()});$(this).siblings("a.table-edit").removeClass("table-edit-unchecked")}})});$.each($(".table-edit"),function(l,k){$(this).off("click").on("click",function(){if(!$(this).hasClass("table-edit-unchecked")){var p=[];function m(){for(var q=0;q<2;q++){var s={};var r=$(f.find(".tr")[q]).children(".td")[l];s.fontSize=$(r).css("font-size");s.fontFamily=$(r).css("font-family");s.color=$(r).css("color");s.fontWeight=r.style.fontWeight;s.fontStyle=$(r).css("font-style");s.textDecoration=$(r).css("text-decoration");s.textAlign=$(r).css("text-align");s.beforStyle=$(r).attr("style");s.code=$(r).attr("code");p.push(s)}}m();if($(document.body).find(".table-ctrl").length<=0){o();$('<div class="ctrl-item"><label class="ctrl-item-title">code</label><div class="ctrl-item-content"><input class="code" type="text" ></div></div>').appendTo($(".table-header .table-style"))}function o(){b(".table-ctrl");drag(".table-ctrl>.title",".table-ctrl",document.body);$(".table-ctrl>.title").html("修改表格样式");$(".table-ctrl>.btn-delete").remove();$('<div class="table-header"><div class="title">表头的样式</div><div class="table-style"></div></div>').appendTo($(".table-ctrl>.panel-ctrl"));$('<div class="table-body"><div class="title">表体的样式</div><div class="table-style"></div></div>').appendTo($(".table-ctrl>.panel-ctrl"));$('<div class="btns"><div class="btn-confirm">确定</div><div class="btn-cancel">取消</div></div>').appendTo($(".table-ctrl"));var q=$('<div class="ctrl-item"><label class="ctrl-item-title">字体/号</label><div class="ctrl-item-content"><select class="font-select" name="fontFamily"><option value="黑体" name="heiTi">黑体</option><option value="楷体" name="kaiTi">楷体</option><option value="宋体" name="songTi">宋体</option><option value="微软雅黑" name="yahei">微软雅黑</option></select><div class="font-size"><span class="icon-font"></span><input class="font-number" type="number" name="font-number" value="16" min="12"></div></div></div><div class="ctrl-item"><label class="ctrl-item-title">粗斜体</label><div class="ctrl-item-content font-set"><div class="font-color">A<input class="color-choose" type="color"></div><div class="font-bold">B</div><div class="font-italic">I</div><div class="font-underline">U</div></div></div><div class="ctrl-item"><label class="ctrl-item-title">对齐</label><div class="ctrl-item-content text-align"><div class="text-left"></div><div class="text-center"></div><div class="text-right"></div></div></div>');q.appendTo($(".table-style"))}n(p);function n(s){function q(t){var u=t===".table-header"?0:1;$(".table-header .code").val(s[0].code);$.each($(t+" .font-select option"),function(v,w){if(w.innerHTML===s[u].fontFamily){this.selected=true}});$(t+" .font-number").val(parseInt(s[u].fontSize));switch(s[u].textAlign){case"left":$($(t+" .text-align>div")[0]).addClass("active").siblings().removeClass("active");break;case"center":$($(t+" .text-align>div")[1]).addClass("active").siblings().removeClass("active");break;case"right":$($(t+" .text-align>div")[2]).addClass("active").siblings().removeClass("active");break}$(t+" .font-color").css("color",s[u].color);s[u].fontWeight==="bold"?$(t+" .font-bold").addClass("active"):$(t+" .font-bold").removeClass("active");s[u].fontStyle==="italic"?$(t+" .font-italic").addClass("active"):$(t+" .font-italic").removeClass("active");s[u].textDecoration.indexOf("underline")>-1?$(t+" .font-underline").addClass("active"):$(t+" .font-underline").removeClass("active")}q(".table-header");q(".table-body");function r(){$(".table-header .code").off("change").on("change",function(){$(f.find("th.td")[l]).attr("code",$(this).val())});$(".table-header .font-select").off("change").on("change",function(){f.find("th.td")[l].style.fontFamily=$(this).val()});$(".table-body .font-select").off("change").on("change",function(){var t=$(this).val();$.each(f.find(".tr"),function(u,v){if(u>0){$(this).find("td.td")[l].style.fontFamily=t}})});$(".table-header .font-number").off("change").on("change",function(){f.find("th.td")[l].style.fontSize=$(this).val()+"px"});$(".table-body .font-number").off("change").on("change",function(){var t=$(this).val()+"px";$.each(f.find(".tr"),function(u,v){if(u>0){$(this).find("td.td")[l].style.fontSize=t}})});$(".table-header .color-choose").off("change").on("change",function(){f.find("th.td")[l].style.color=$(this).val();$(this).parents(".font-color").css("color",$(this).val())});$(".table-body .color-choose").off("change").on("change",function(){$(this).parents(".font-color").css("color",$(this).val());var t=$(this).val();$.each(f.find(".tr"),function(u,v){if(u>0){$(this).find("td.td")[l].style.color=t}})});$(".table-header .font-bold").off("click").on("click",function(){$(this).toggleClass("active");$(this).hasClass("active")?$(f.find("th.td")[l]).css("font-weight","bold"):$(f.find("th.td")[l]).css("font-weight","normal")});$(".table-body .font-bold").off("click").on("click",function(){var t=$(this);t.toggleClass("active");$.each(f.find(".tr"),function(u,v){if(u>0){t.hasClass("active")?$($(this).find("td.td")[l]).css("font-weight","bold"):$($(this).find("td.td")[l]).css("font-weight","normal")}})});$(".table-header .font-italic").off("click").on("click",function(){$(this).toggleClass("active");$(this).hasClass("active")?$(f.find("th.td")[l]).css("font-style","italic"):$(f.find("th.td")[l]).css("font-style","normal")});$(".table-body .font-italic").off("click").on("click",function(){var t=$(this);t.toggleClass("active");$.each(f.find(".tr"),function(u,v){if(u>0){t.hasClass("active")?$($(this).find("td.td")[l]).css("font-style","italic"):$($(this).find("td.td")[l]).css("font-style","normal")}})});$(".table-header .font-underline").off("click").on("click",function(){$(this).toggleClass("active");$(this).hasClass("active")?$(f.find("th.td")[l]).css("text-decoration","underline"):$(f.find("th.td")[l]).css("text-decoration","none")});$(".table-body .font-underline").off("click").on("click",function(){var t=$(this);t.toggleClass("active");$.each(f.find(".tr"),function(u,v){if(u>0){t.hasClass("active")?$($(this).find("td.td")[l]).css("text-decoration","underline"):$($(this).find("td.td")[l]).css("text-decoration","none")}})});$(".table-header .text-align>div").off("click").on("click",function(){var t=$(this).index();$(this).addClass("active").siblings().removeClass("active");switch(t){case 0:$(f.find("th.td")[l]).css("text-align","left");break;case 1:$(f.find("th.td")[l]).css("text-align","center");break;case 2:$(f.find("th.td")[l]).css("text-align","right");break}});$(".table-body .text-align>div").off("click").on("click",function(){var t=$(this);var u=$(this).index();$(this).addClass("active").siblings().removeClass("active");$.each(f.find(".tr"),function(v,w){if(v>0){switch(u){case 0:$($(this).find("td.td")[l]).css("text-align","left");break;case 1:$($(this).find("td.td")[l]).css("text-align","center");break;case 2:$($(this).find("td.td")[l]).css("text-align","right");break}}})})}r()}$(".table-ctrl .btn-confirm").off("click").on("click",function(){$(".table-ctrl").remove()});$(".table-ctrl .btn-cancel").off("click").on("click",function(){$(".table-ctrl").remove();$(f.find(".tr")[0]).children(".td")[l].style=p[0].beforStyle;$.each(f.find(".tr"),function(q,r){if(q>0){$(this).find(".td")[l].style=p[1].beforStyle}})})}})})};var d=function(){$(".edit-panel .panel-ctrl").html("");var j={};j.fontSize=f.css("font-size");j.fontFamily=f.css("font-family");j.color=f.css("color");j.fontWeight=f[0].style.fontWeight;j.fontStyle=f.css("font-style");j.textDecoration=f.css("text-decoration");j.textAlign=f.css("text-align");j.beforStyle=f.attr("style");j.code=f.attr("code")?f.attr("code"):"";var g=$('<div class="ctrl-item"><label class="ctrl-item-title">字体/号</label><div class="ctrl-item-content"><select class="font-select" name="fontFamily"><option value="黑体" name="heiTi">黑体</option><option value="楷体" name="kaiTi">楷体</option><option value="宋体" name="songTi">宋体</option><option value="微软雅黑" name="yahei">微软雅黑</option></select><div class="font-size"><span class="icon-font"></span><input class="font-number" type="number" name="font-number" value="16" min="12"></div></div></div>\n<div class="ctrl-item"><label class="ctrl-item-title">粗斜体</label><div class="ctrl-item-content font-set"><div class="font-color">A<input class="color-choose" type="color"></div><div class="font-bold">B</div><div class="font-italic">I</div><div class="font-underline">U</div></div></div><div class="ctrl-item"><label class="ctrl-item-title">对齐</label><div class="ctrl-item-content text-align"><div class="text-left"></div><div class="text-center"></div><div class="text-right"></div></div></div><div class="ctrl-item"><label class="ctrl-item-title">code</label><div class="ctrl-item-content"><input class="code" type="text"></div></div>');g.appendTo($(".edit-panel .panel-ctrl"));h();function h(){$.each($(".font-select option"),function(l,k){if(k.innerHTML===j.fontFamily){this.selected=true}});$(".font-number").val(parseInt(j.fontSize));switch(j.textAlign){case"left":$($(".text-align>div")[0]).addClass("active").siblings().removeClass("active");break;case"center":$($(".text-align>div")[1]).addClass("active").siblings().removeClass("active");break;case"right":$($(".text-align>div")[2]).addClass("active").siblings().removeClass("active");break}$(".font-color").css("color",j.color);j.fontWeight==="bold"?$(".font-bold").addClass("active"):$(".font-bold").removeClass("active");j.fontStyle==="italic"?$(".font-italic").addClass("active"):$(".font-italic").removeClass("active");j.textDecoration.indexOf("underline")>-1?$(".font-underline").addClass("active"):$(".font-underline").removeClass("active");$(".code").val(j.code)}i();function i(){$(".font-select").off("change").on("change",function(){f[0].style.fontFamily=$(this).val()});$(".font-number").off("change").on("change",function(){f[0].style.fontSize=$(this).val()+"px"});$(".color-choose").off("change").on("change",function(){f[0].style.color=$(this).val();$(this).parents(".font-color").css("color",$(this).val())});$(".font-bold").off("click").on("click",function(){$(this).toggleClass("active");$(this).hasClass("active")?$(f).css("font-weight","bold"):$(f).css("font-weight","normal")});$(".font-italic").off("click").on("click",function(){$(this).toggleClass("active");$(this).hasClass("active")?$(f).css("font-style","italic"):$(f).css("font-style","normal")});$(".font-underline").off("click").on("click",function(){$(this).toggleClass("active");$(this).hasClass("active")?$(f).css("text-decoration","underline"):$(f).css("text-decoration","none")});$(".text-align>div").off("click").on("click",function(){var k=$(this).index();$(this).addClass("active").siblings().removeClass("active");switch(k){case 0:$(f).css("text-align","left");break;case 1:$(f).css("text-align","center");break;case 2:$(f).css("text-align","right");break}});$(".code").off("change").on("change",function(){f.attr("code",$(this).val())})}};var a=function(){var g=f.text();d();$('<div class="ctrl-item"><label class="ctrl-item-title">文字项目</label><div class="ctrl-item-content"><input class="custom-content" type="text" value="'+g+'"></div></div>').appendTo($(".edit-panel .panel-ctrl"));$(".edit-panel .custom-content").on("input",function(){f.find(".custom-text").text($(this).val())})};var c=function(){$(".edit-panel .panel-ctrl").html("");f.css("background-color","#fff");var j={};if(f.attr("direction")==="horizontal"){j.lineWidth=f.css("border-top-width");j.lineColor=rgb2hex(f.css("border-top-color"));j.lineStyle=f.css("border-top-style")}else{if(f.attr("direction")==="vertical"){j.lineWidth=f.css("border-right-width");j.lineColor=rgb2hex(f.css("border-right-color"));j.lineStyle=f.css("border-right-style")}}j.lineDirection=f.attr("direction");j.code=f.attr("code");var g=$('<div class="ctrl-item"><label class="ctrl-item-title">线条样式</label><div class="ctrl-item-content"><select class="line-style" name="lineStyle"><option value="solid" name="solid">solid</option><option value="dashed" name="dashed">dashed</option><option value="dotted" name="dotted">dotted</option><option value="double " name="double">double</option></select></div></div>\n<div class="ctrl-item"><label class="ctrl-item-title">线条宽度</label><input class="line-width" type="number" name="line-width" value="2">px</div><div class="ctrl-item"><label class="ctrl-item-title">线条颜色</label><div class="ctrl-item-content"><div class="line-color"><input class="color-choose" type="color"></div></div></div><div class="ctrl-item"><label class="ctrl-item-title">线条方向</label><div class="ctrl-item-content line-direction"><div class="line-horizontal active">水平</div><div class="line-vertical">垂直</div></div></div><div class="ctrl-item"><label class="ctrl-item-title">code</label><div class="ctrl-item-content"><input class="code" type="text"></div></div>');g.appendTo($(".edit-panel .panel-ctrl"));h();function h(){$.each($(".line-style option"),function(l,k){if(k.innerHTML===j.lineStyle){this.selected=true}});$(".line-width").val(parseInt(j.lineWidth));$(".line-color .color-choose").val(j.lineColor);$.each($(".line-direction>div"),function(l,k){if(k.className.indexOf(j.lineDirection)>-1){$(k).addClass("active").siblings().removeClass("active")}});$(".code").val(j.code)}i();function i(){$(".line-style").off("change").on("change",function(){f[0].style.borderTopStyle=$(this).val();f[0].style.borderRightStyle=$(this).val()});$(".line-width").off("change").on("change",function(){f[0].style.borderTopWidth=$(this).val()+"px";f[0].style.borderRightWidth=$(this).val()+"px"});$(".color-choose").off("change").on("change",function(){f[0].style.borderTopColor=$(this).val();f[0].style.borderRightColor=$(this).val()});$(".line-direction").off("click").on("click","div",function(){$(this).addClass("active").siblings().removeClass("active");if($(this).hasClass("line-horizontal")){if(parseInt(f.css("height"))>=50){f.css("width",f.css("height"))}f.addClass("line-h").removeClass("line-v");f.attr("direction","horizontal")}else{if($(this).hasClass("line-vertical")){if(parseInt(f.css("width"))>=50){f.css("height",f.css("width"))}f.addClass("line-v").removeClass("line-h");f.attr("direction","vertical")}}});$(".code").off("change").on("change",function(){f.attr("code",$(this).val())})}};var b=function(h){var i=document.createDocumentFragment();var g=createElement("div",{"class":h.split(".")[1]});$(g).appendTo($(i));$('<div class="title">打印项目编辑</div>').appendTo($(g));$(createElement("div",{"class":"panel-ctrl"})).appendTo($(g));$('<div class="btn-delete">删除打印项目</div>').appendTo($(g));$(i).appendTo($(document.body))}};var Xedit=function(){this.elem="";this.init=function(c,a,b){$(c).html("");this.elem=c;a=a?a:$(c).width();b=b?b:$(c).height();$(c).css({position:"relative",width:a,height:b,padding:"18px",border:"1px solid #ccc",overflow:"hidden"});$('<div id="stage"><div id="panel"></div></div>').appendTo($(c));renderRule("#panel",c);xedit.addPanel();addElement();panel();resize(".move-element");$.each($("#panel .move-element"),function(){drag(this,this,"#panel")});drag(".table-ctrl>.title",".table-ctrl",document.body);drag(".add-panel>.title",".add-panel",document.body)};this.addPanel=function(){if($(document.body).find(".add-panel").length<=0){var b=$('<div class="add-panel"><div class="title">打印项目添加</div></div>').appendTo($(document.body));var a=$('<div class="add-ctrl"></div>').appendTo(b);$('<div class="ctrl-item add-table" xedit-type="table">添加一个表格</div>').appendTo(a);$('<div class="ctrl-item add-custom" xedit-type="xlable">自定义文字</div>').appendTo(a);$('<div class="ctrl-item add-default" xedit-type="lable" xedit-code="username" xedit-text="[姓名]">收货人-姓名</div>').appendTo(a);$('<div class="ctrl-item add-line" xedit-type="line">线条</div>').appendTo(a)}};this.get=function(){var a={};a.panel={width:$(this.elem)[0].offsetWidth,height:$(this.elem)[0].offsetHeight};a.elements=[];$.each($("#panel .move-element"),function(){$(this).css("background-color","#fff");$(this).find(".rth").remove();var c={};c.x=this.offsetLeft;c.y=this.offsetTop;c.w=this.offsetWidth;c.h=this.offsetHeight;c.style=$(this).attr("style");c.code=$(this).attr("code");if($(this).hasClass("table")){c.type="table";c.tableData={};var b=[];var d=[];$.each($(this).find("th.td"),function(){var e={};e.itemValue=this.innerHTML;e.code=$(this).attr("code");e.style=$(this).attr("style");if(this.style.display!=="none"){e.isShow=true}else{e.isShow=false}b.push(e)});$.each($($(this).find(".tr")),function(g,f){if(g>0){var e=[];$.each($(f).find("td.td"),function(){var h={};h.itemValue=this.innerHTML;h.style=$(this).attr("style");if(this.style.display!=="none"){h.isShow=true}else{h.isShow=false}e.push(h)});d.push(e)}});c.tableData.gridHeader=b;c.tableData.gridBody=d;a.elements.push(c)}else{if($(this).hasClass("div-default")){c.type="label";c.value=$(this).children(".default-text").text();a.elements.push(c)}else{if($(this).hasClass("div-custom")){c.type="xlabel";c.value=$(this).children(".custom-text").text();a.elements.push(c)}else{if($(this).hasClass("div-line")){c.type="line";c.direction=$(this).attr("direction");a.elements.push(c)}}}}});$(".edit-panel").remove();return a};this.setWidth=function(a){$(this.elem).css("width",a);renderRule("#panel",this.elem)};this.setHeight=function(a){$(this.elem).css("height",a);renderRule("#panel",this.elem)};this.setDatas=function(a){this.init("#target");$("#panel").html("");$(".edit-panel").remove();this.setWidth(a.panel.width);this.setHeight(a.panel.height);$.each(a.elements,function(c,b){switch(b.type){case"label":var d=$('<div class="div-default move-element" code="'+b.code+'" style="'+b.style+'"><span class="default-text">'+b.value+"</span></div>").appendTo($("#panel"));break;case"xlabel":var d=$('<div class="div-custom move-element"  code="'+b.code+'" style="'+b.style+'"><span class="custom-text">'+b.value+"</span></div>").appendTo($("#panel"));break;case"line":var d=$('<div class="div-line move-element" direction="'+b.direction+'"  code="'+b.code+'" style="'+b.style+'"></div>').appendTo($("#panel"));switch($(d).attr("direction")){case"horizontal":$(d).addClass("line-h").removeClass("line-v");break;case"vertical":$(d).addClass("line-v").removeClass("line-h");break}break;case"table":addTable(b.tableData,b);break}d!==undefined&&d.css({width:b.w,height:b.h,left:b.x,top:b.y});drag(d,d,"#panel");resize(".move-element");panel()});return $("#stage").html()};this.setImg=function(a){if($("#panel").find(".panel-bg").length<=0){var b=$('<div class="move-element"><img class="panel-bg" alt=""></div>').appendTo($("#panel"));b.css("z-index",0);drag(b,b,"#panel");resize(".move-element");panel()}$(".panel-bg").attr("src",a)};this.addTable=function(a){addTable(a);resize(".move-element");panel()};this.addDefault=function(a){var b=$('<div class="div-default move-element"><span class="default-text">【'+a+"】</span></div>").appendTo($("#panel"));drag(b,b,"#panel");resize(".move-element");panel()};this.addCustom=function(a){var b=$('<div class="div-custom move-element"><span class="custom-text">【'+a+"】</span></div>").appendTo($("#panel"));drag(b,b,"#panel");resize(".move-element");panel()};this.getHtml=function(a){var b=this.setDatas(a);return b}};var xedit=new Xedit();